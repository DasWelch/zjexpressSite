{"componentChunkName":"component---src-templates-blog-post-js","path":"/GettingP5ToWorkInGatsby/","result":{"data":{"site":{"siteMetadata":{"title":"ZJ Express"}},"markdownRemark":{"id":"ffb4cefe-5708-55dd-9849-5e9db14a6633","excerpt":"P5 and Gatsby one of the goals of this site was to allow me to share my passion for creating simulations, art, and visual models using the P5js library. I’ve…","html":"<h2>P5 and Gatsby</h2>\n<p>one of the goals of this site was to allow me to share my passion for creating simulations, art, and visual models using the P5js library. I’ve used P5 for a few years. It is a wonderful library for everyone from artists and beginners all the way up to experienced coders. It makes it simple to create a visual representation of what ever you would like.</p>\n<p>In the past I have used P5 with static sites made of just HTMLand CSS. It is a simple library to work with when you have little other JavaScript running on the page. This site is made with a static site generator called Gatsby. Gatsby utilizes React and node.js to create fast and beautiful static sites. It is a great way to create a personal site or blog, but using it with third party libraries such as P5 can present quite a challenge.</p>\n<p>Below we will go over how to get a sketch working, first in P5 itself, then in React, and finally we will move all of this into a Gatsby starter site. I am going to assume that you have a basic understanding of React. Additionally, having some experience with P5JS would also be good. Finally we will be using <a href=\"https://codepen.io/\">code pen</a> to hold and run our code until we reach the Gatsby section.</p>\n<h3>Working With P5</h3>\n<p>We will start off with getting P5 working and in the proper mode for our site. P5 has two modes “Global mode” and “Instance mode”. “Global mode” uses the “Global Context” or the window object of a page. It allows us to simply add the P5 CDN to our document, type out what P5 functions and classes we want to use and throw them into a JavaScript file we import(or if your bad just use a script tag). This is a simple and quick approach when we are using basic html and css and not using other libraries.</p>\n<p>“Instance mode” is a little more complicated, but is far more adaptable. This mode “namespaces” our sketch to ensure it can work properly even in very complicated environments, such as one using React. But what is “Namespacing” and how does it help us here? “Namespacing” in our context is creating an object where all of the P5 library’s functions and classes will work within. Technically we create an object for our library so we do not have name collisions with other JavaScript objects running in our site. It keeps our P5 code from “tangling up and tripping over” the other JavaScript working on the page.</p>\n<h4>A quick note about following along</h4>\n<p>If you are planing to follow along with this guide on CodePen you will need to add the P5, ReactJs, and React-Dom Libraries. You can add them by going into the settings menu in your pen, clicking on the js option on the left menu, and searching for P5 React and React-Dom in the search bar. the js section of the settings will look something like below when done.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 153.1645569620253%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEB0lEQVRIx+2W21NbVRTGz0txuORKLidAw6XhksvJlYRLkt6cTh0taZCiQiUJpYLtTMuD77aO1Ie+qbUjLeVW6AzR6rQFFSoEShIi0ILoQ9989q/43HsfDm3SjIM+9+E339pr7b2yzt577Qlntgho9DbD4/FBozVAXaon6LIo1eih05dBq3sV6qfxyqpa1NUL4ExWC+qcAqrN9dCyIM8mUTRanqFQanCgoBAFbxThQA7MR2KFRXLoeSM4u8OFCmMV5Ao1w1TbgC+/uonbI+MYvnUHt26PsvGnVz7H1c+GcOXqq9DYtS+u44OuKLhGXxCVNRbUmGxMBUcjpqbjePDwZzx8JPJo9hfMLyxh4XEiL/MLi1h5ksblwU/A1dVbIdjdqKqug4bsCW+ogCA4YbbYGFabg6lKrYVMrkKJTIniEgXTl5HJ1WRtJTjB7kV7KIj3QyYUlahRVn4Qrf4jCASPInj4OPyBo8Q+Bpfbx364wSzA7vDAJrjgdHmZ7XA2wu1pwkFjDTgPOWGny4mKcj1U5ES1OgPZRzNo5YdMDXtaW2dh6PkKQjmbR1VHkHz0tDmvr5n8ihtKtY6cZilZZMadsUl8f/8BZuI/7BH/7kemU9MzWYyOTmBkZAzx+H30D1wEZxMc8Hj96DhlRZNbj+pDFoyN38Xk3XuYmJzG+MTULtMM6qdQ39S9Gaw//R2bO8/x/K+/MXTtOjgtuWe0fIPBAJ7nyYYrceLkO+TKjOLrG9/ixjfDIjeHX9gEGqNzllZSWE5vELZw4eIgOKkbVOST6SUuKpajqzuCjc1trCYzSKZ+Y6TS61jdtSXWMptIr60jlcogk9lAJNoHjm6khJhQga6zUZZgcWkVSwmRxHJStIkmdhFjSTLvCdY3tvHxhUvZCbW7FXa+182q+3VxhU2m0MWS5oNWHOv9KE+F5NLShI9Jstm5Bcz9JDJLmZvfg/lInHYRhSY91zeQ/5O7z8bYniSWV0lLpZAk1a6tbbBtSBN9+mwHz7b+IOwwe2v7T7afp9rC2Qkp9C7Sfj4/MIjz/ZfQ138ZHZ0foqU1QLpG7KDDR47vQbuJKvUbK2teJJTePXbqRHmDEXyZkSl90opL5KyH80H3napSpcmu8OWk9DGQoGPpbfw3WOvlfrKUdL/+XLj9TPovvE74OuH/T0hvup5BbRFpEp/jy1G6RseLEJuTK1SglMjUDGm8HxRKNZSyUigKlAxloYr8FXG1wOEOoKXFi+ZmH+wuP5weP/G1wuFqhdMtjqk63FJMVKvVh9qgB9ZzxxgNHX5wb7d14XRHH3ojIUIYbe29OP1uBG3hHoTaibb3IHwmRuZEiR1BiMTCHTGEO2M48eYZuHveQmAsgsB4FE1DnfgHCnA0kA6A6UUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JS section of settings\"\n        title=\"JS section of settings\"\n        src=\"/static/4c4411614bf0888b5e04ac6609f24c8c/f058b/PenJSImports.png\"\n        srcset=\"/static/4c4411614bf0888b5e04ac6609f24c8c/c26ae/PenJSImports.png 158w,\n/static/4c4411614bf0888b5e04ac6609f24c8c/6bdcf/PenJSImports.png 315w,\n/static/4c4411614bf0888b5e04ac6609f24c8c/f058b/PenJSImports.png 630w,\n/static/4c4411614bf0888b5e04ac6609f24c8c/f6386/PenJSImports.png 686w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>If you still have trouble check out this <a href=\"https://codepen.io/daswelch/pen/eYpYLLG\">pen’s</a> settings for something to copy and paste. Now lets get back to getting P5 working</p>\n<h3>Lets get our P5 code working in “Global mode”</h3>\n<iframe  style=\"width: 100%; height: 400px;\" scrolling=\"no\" title=\"Basic P5 Sketch\" src=\"https://codepen.io/daswelch/embed/zYvqrQv?height=265&theme-id=dark&default-tab=js,result\" frameborder=\"yes\" allowtransparency=\"true\" allowfullscreen=\"true\" loading=\"lazy\">\nSee the Pen <a href='https://codepen.io/daswelch/pen/zYvqrQv'>Basic P5 Sketch</a> by DasWelch\n(<a href='https://codepen.io/daswelch'>@daswelch</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<p>The sketch above is running “Global mode”. I have added in a class to ensure it will demonstrate converting just about any P5 sketch into an “Instance mode” Sketch. In our Pens “result” section, we have a black background with two box objects being drawn. Like any P5 sketch we will start by declaring our objects(“b” and “d” Both Boxes) and our setup and draw functions.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// the start of our P5 sketch ///</span>\n\n<span class=\"token keyword\">let</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> d<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    d <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    b<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    d<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Below that we will create our Box class. This will be what we use to create boxes on our background.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// Adding the Box class to our code above ///</span>\n\n<span class=\"token keyword\">let</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> d<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/// Our Box class ///</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_x<span class=\"token punctuation\">,</span> _y<span class=\"token punctuation\">,</span> _w<span class=\"token punctuation\">,</span> _h</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> _x<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> _y<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>w <span class=\"token operator\">=</span> _w<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>h <span class=\"token operator\">=</span> _h<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">rect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Though this class does not have a lot of functionality, it will help us to demonstrate using classes with “Instance mode”. Also notice that our sketch just sort of works. It just runs and we do not have to define a start or an object to start it when it is running in “Global mode”.</p>\n<h3>Lets convert sketch to use “Instance mode”</h3>\n<iframe style=\"width: 100%; height: 400px;\" scrolling=\"no\" title=\"p5 instance mode with class \" src=\"https://codepen.io/daswelch/embed/XWmWOxG?height=265&theme-id=dark&default-tab=js,result\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" loading=\"lazy\">\nSee the Pen <a href='https://codepen.io/daswelch/pen/XWmWOxG'>p5 instance mode with class </a> by DasWelch\n(<a href='https://codepen.io/daswelch'>@daswelch</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<p>Now we will take our working sketch and convert it to an “Instance mode” sketch. To start, we need to create a container to isolate our P5 sketch. We will do this by creating a variable called “sketch”. we then set this equal to an anonymous function and pass in a single parameter to this function “p”. This “p” will be the object we use to namespace our P5 library.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// our new sketch Object ///</span>\n\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">sketch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next we will copy our non class specific code and paste it inside this function. Though we will be making changes to the original code, it is a good start. We can leave our variables “b” and “d” alone and move down to our setup and draw functions. For both the setup and the draw function, we are going to convert each into its own anonymous function. We will use the “p” parameter that we passed into our sketch function to call them. We will set our new anonymous functions equal to “p.setup” and “p.draw” respectively.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// Reworking our setup and draw functions for \"Instance mode\" ///</span>\n\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">sketch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> d<span class=\"token punctuation\">;</span>\n\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setup</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// left out the contents to help with clarity</span>\n    <span class=\"token punctuation\">}</span>\n\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">draw</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// left out the contents to help with clarity</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we will modify each of the functions under setup and draw to be called by our “p” variable. For example “background(0)” in draw would become “p.background(0)“.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// Our P5 functions in \"Instance mode\" ///</span>\n\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">sketch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> d<span class=\"token punctuation\">;</span>\n\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setup</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// notice our additional code</span>\n        p<span class=\"token punctuation\">.</span><span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        p<span class=\"token punctuation\">.</span><span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// we have added our \"p\" parameter here. this will be explained shortly.</span>\n        b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        d <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">draw</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n       p<span class=\"token punctuation\">.</span><span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       b<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       d<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next we will move outside of our base sketch function and focus on the Box class. Because were working no longer working in “Global mode”, attempting to access P5 functions without an instance object becomes impossible. So how do we access our P5 functions here? We pass instance object into our class. In our Box class constructor we will pass in a variable ”<em>p” and set this.p equal to it. The ”</em>p” is the instance object(“p”) from above. It will allow us to use all of the P5 functions we want.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// Our box class with the Instance object passed in ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_p<span class=\"token punctuation\">,</span> _x<span class=\"token punctuation\">,</span> _y<span class=\"token punctuation\">,</span> _w<span class=\"token punctuation\">,</span> _h</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// this p is our P5 instance object</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p <span class=\"token operator\">=</span> _p<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> _x<span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we can move into our class methods. Unlike our setup and draw functions we do not need to use our instance object “this.p” to call our methods. We do however need to use “this.p” to call any P5 functions. For example we would change our “fill(255)” to “this.p.fill(255)“.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// the modified P5 functions ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">rect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Finally to get our “Instance mode” sketch working we will need to create a new variable that will hold a functioning canvas with our sketch on it. We will call this variable “mySketch” and set this new variable equal to a new P5 instance using the “new P5(Sketch, “container”)” function. In this function the “sketch” parameter is the sketch object we created earlier and the “container” parameter is the id of the tag on which our P5 sketch will be attached. If we do not have any HTML tags we want to attach our sketch to, our “container” parameter can be arbitrarily set to  any string we would like to use.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/// The object that will run our P5 code ///</span>\n\n<span class=\"token keyword\">let</span> mySketch <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">p5</span><span class=\"token punctuation\">(</span>sketch<span class=\"token punctuation\">,</span> <span class=\"token string\">\"container\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Getting React to work Properly</h3>\n<iframe height=\"265\" style=\"width: 100%; height: 400px;\" scrolling=\"no\" title=\"getting p5 working in react\" src=\"https://codepen.io/daswelch/embed/eYpYLLG?height=265&theme-id=dark&default-tab=js,result\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" loading=\"lazy\">\nSee the Pen <a href='https://codepen.io/daswelch/pen/eYpYLLG'>getting p5 working in react</a> by DasWelch\n(<a href='https://codepen.io/daswelch'>@daswelch</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<p>Now comes the part of moving our working “Instance mode” sketch into a React component. We will create a React class to house our sketch and its parts. To start we will plug in the boiler plate as shown below.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// Our React Boiler plate ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span> \n\n         <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To this boiler plate, we are going to add a React reference. A reference allows us to use and modify an element on the page that is not directly under the control of React. This reference will allow our P5 sketch to attach and run on the DOM even with React creating it. We will use React’s “React.createRef()” function to create and add a reference to our class. We then create a variable called “this.myRef” to hold that reference in the class constructor.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// Adding in our React Reference ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In addition to this we will utilize the React’s “componentDidMount()” function. This will ensure that our sketch will run at the right time and have something to attach to. under our “componentDidMount()” function we will add our P5 instance object declaration, as well as the P5 function itself. Just like before our P5 function will take in our sketch object (“this.sketch”) as well as something to attach that canvas and sketch to. In this case that attachment point will be “this.myRef.current”. The “.current” is a required attribute when we use the reference under the “componentDidMount” function.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// Creating our instance under componentDidMount()///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">...</span>\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myP5 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">p5</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sketch<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next we will prepare the render function. This will return a “div” tag with its ref property set to the “MySketch” reference we set up earlier.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// Setting up our Render Function ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">...</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span> \n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We now will add in our actual “Instance mode” sketch object below our constructor method. Notice we now drop the “let” declaration before the sketch as it is within our class.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// adding in our \"Instance mode\" sketch ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function-variable function\">sketch</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> d<span class=\"token punctuation\">;</span>\n\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setup</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      p<span class=\"token punctuation\">.</span><span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      p<span class=\"token punctuation\">.</span><span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      d <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">draw</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      p<span class=\"token punctuation\">.</span><span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      b<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      d<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myP5 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">p5</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sketch<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>finally we can add our Box class below our “MySketch” React class. Just like it was before we added in React.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_p<span class=\"token punctuation\">,</span> _x<span class=\"token punctuation\">,</span> _y<span class=\"token punctuation\">,</span> _w<span class=\"token punctuation\">,</span> _h</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// this p is our p5 instance object</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p <span class=\"token operator\">=</span> _p<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> _x<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> _y<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>w <span class=\"token operator\">=</span> _w<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>h <span class=\"token operator\">=</span> _h<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">rect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we will add a “div” tag with an id of root into the HTML section that will be our root element for React. This will be the point React uses to render our component. We then add the ReactDOM.render(<code class=\"language-text\">&lt;MySketch/&gt;</code>, document.getElementById(“root”))” function with our class as its first argument and a “document.getElementById” function as its second.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- Our HTML root tag for React to use --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- we can leave this empty as it will be filled programmatically  --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">///our ReactDom.Render function ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MySketch</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Once that is done we will have a functional P5 sketch running inside of React. The finished sketch is at the top of this section if you would like to reference it. Our next task will be transferring this running “MySketch” class into our Gatsby site.</p>\n<h3>Bringing it together in Gatsby</h3>\n<p>Before we start our transfer well need to have our Gatsby environment set up and running. Im going to assume that you are running a basic starter site from Gatsby. Additionally I am going to assume that you know how to use NPM to add packages to your Gatsby installation. If would like some more resources for either of these, here is a link to <a href=\"https://www.gatsbyjs.org/docs/quick-start/\">Gatsbys starter docs</a> and <a href=\"https://www.npmjs.com/get-npm\">NPM starter docs</a>.</p>\n<p>Were going to start by installing P5 from NPM. To do this well move into the root of our Gatsby site and open our shell. Make sure your shell is showing that you are in the root folder for your gatsby starter site. In the shell we will run the npm install command for P5 shown below.</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\"># Windows\nC: Windows\\PathToRootOfProject\\startersite&gt; npm install --save p5\n#   or\n# Linux\nbashUser:~/PathToRootOfProject/startersite$ npm install --save p5</code></pre></div>\n<p>Now we will be able to use P5 in our site. I’ll quickly mention there are other ways to add P5 to a website, but this is the most reliable method I was able find. Now we can open up our editor. I like to use Visual Studio Code which has an easy command to open it “code .” in the root of the Gatsby site. from here well move to our “src” folder and then our “components” folder. From there we will create a new file named “mysketch.js”. This will be where we place our React component. We can copy and paste our React code from our pen and make some modifications to have it work properly.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// our React code in file under src > components > mysketch.js ///</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function-variable function\">Sketch</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> d<span class=\"token punctuation\">;</span>\n\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setup</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      p<span class=\"token punctuation\">.</span><span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      p<span class=\"token punctuation\">.</span><span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      d <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    p<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">draw</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      p<span class=\"token punctuation\">.</span><span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      b<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      d<span class=\"token punctuation\">.</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myP5 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">p5</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Sketch<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myRef<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_p<span class=\"token punctuation\">,</span> _x<span class=\"token punctuation\">,</span> _y<span class=\"token punctuation\">,</span> _w<span class=\"token punctuation\">,</span> _h</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// this p is our p5 instance object</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p <span class=\"token operator\">=</span> _p<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> _x<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> _y<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>w <span class=\"token operator\">=</span> _w<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>h <span class=\"token operator\">=</span> _h<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">rect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MySketch</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>First we will add in two import statements at the top of the page. The first import will be for React and the second will be for our P5 library. We need these now because we are importing the libraries locally and not using an online CDN to pull in what we need.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// component with its import files added ///</span>\n\n<span class=\"token comment\">// these are our two imports</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token constant\">P5</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"p5\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MySketch</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next we will remove the “ReactDom.render()” function. We will no longer be using this function as Gatsby will be handling the rendering of our pages. Instead we will add an “export default” statement for “MySketch” below our Box class.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// component with its import files added ///</span>\n\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token constant\">P5</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"p5\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MySketch</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Box</span> <span class=\"token punctuation\">{</span>\n <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MySketch</code></pre></div>\n<p>Now we should have a functional React component that we can add a to a page. Lets test this! Lets move to our “pages” folder. This can be found under the “src” directory. From here we will make a copy of our index.js file in the “pages” folder. Lets rename this to “sketchtester.js”. Open this new page up and get rid of most of the stuff in the file. We should also change the page object name so we do not confuse our new file with our “index.js” file in the same folder. Lets rename our page object SketchTester.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// sketchtester.js file at src > pages > sketchtester.js</span>\n\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SketchTester</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">// We have removed all of the tags from our index page object</span>\n  <span class=\"token comment\">// in the next step we will add our sketch </span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> SketchTester</code></pre></div>\n<p>Now Lets import our new sketch component and add it to our file. To do this we will add an import statement to the top of our file and then create a JSX tag with the name we gave to our imported sketch component.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/// sketchtester.js file at src > pages > sketchtester.js</span>\n\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> MySketch <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/MySketch\"</span>\n\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SketchTester</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MySketch</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> SketchTester</code></pre></div>\n<p>Now we are ready to see our work. We can open our shell back up, making sure its in the root of our Gatsby project. From here, we will run the command “gatsby develop” to get a development version of the site running. We can access our new site at <a href=\"http://localhost:8000/\">http://localhost:8000/</a>, but if we want to see our hard work we can go to our sketch tester page located at ”<a href=\"http://localhost:8000/sketchtester%22\">http://localhost:8000/sketchtester”</a>. now we should be able to see our sketch running in our browser window.</p>\n<p>import Sketch from “$sketches/post2sketch”</p>\n<Sketch bottomText=\"our finished sketch\"/>\n<p>From here you can play with the new sketch component. Try adding movements or creating more boxes within your sketch. You can also play with adding JSX tags on the page and wrap your sketch in your sites layout. Try changing whatever you would like, but remember to make a copy of your component and sketchtester page so you have a template to follow in the future.</p>\n<p>If you have made it here, Thank you for taking the time to read over this whole post! I hope this helps anyone having issues getting P5 sketches in “Instance mode” working, getting sketch working with React, and/or getting a sketch running on a gatsby site. I personally had difficulty finding documentation and help online about each step in this process. I had to stich together many little pieces of information to get to my final goal of a working P5 sketch on my Gatsby site. My next goal is to create more guides about drawing and modeling things using P5 and other drawing libraries. Im also very excited to have my first real post! I’m looking into a comment system soon so hopefully I can get some feed back about how to make this blog better. Thank you for reading and come back soon to see more posts!</p>","frontmatter":{"title":"Getting P5 to work in Gatsby ","date":"April 21, 2020","description":"How to get the base P5 node library to work with a Gatsby static site"},"fileRelativePath":"/content/blog/GettingP5ToWorkInGatsby/index.md","rawFrontmatter":"{\"title\":\"Getting P5 to work in Gatsby \",\"date\":\"2020-04-21\",\"description\":\"How to get the base P5 node library to work with a Gatsby static site\",\"publish\":true}","rawMarkdownBody":"## P5 and Gatsby\n\none of the goals of this site was to allow me to share my passion for creating simulations, art, and visual models using the P5js library. I've used P5 for a few years. It is a wonderful library for everyone from artists and beginners all the way up to experienced coders. It makes it simple to create a visual representation of what ever you would like.\n\nIn the past I have used P5 with static sites made of just HTMLand CSS. It is a simple library to work with when you have little other JavaScript running on the page. This site is made with a static site generator called Gatsby. Gatsby utilizes React and node.js to create fast and beautiful static sites. It is a great way to create a personal site or blog, but using it with third party libraries such as P5 can present quite a challenge.\n\nBelow we will go over how to get a sketch working, first in P5 itself, then in React, and finally we will move all of this into a Gatsby starter site. I am going to assume that you have a basic understanding of React. Additionally, having some experience with P5JS would also be good. Finally we will be using [code pen](https://codepen.io/) to hold and run our code until we reach the Gatsby section.\n\n### Working With P5\n\nWe will start off with getting P5 working and in the proper mode for our site. P5 has two modes \"Global mode\" and \"Instance mode\". \"Global mode\" uses the \"Global Context\" or the window object of a page. It allows us to simply add the P5 CDN to our document, type out what P5 functions and classes we want to use and throw them into a JavaScript file we import(or if your bad just use a script tag). This is a simple and quick approach when we are using basic html and css and not using other libraries.\n\n\"Instance mode\" is a little more complicated, but is far more adaptable. This mode \"namespaces\" our sketch to ensure it can work properly even in very complicated environments, such as one using React. But what is \"Namespacing\" and how does it help us here? \"Namespacing\" in our context is creating an object where all of the P5 library's functions and classes will work within. Technically we create an object for our library so we do not have name collisions with other JavaScript objects running in our site. It keeps our P5 code from \"tangling up and tripping over\" the other JavaScript working on the page.\n\n#### A quick note about following along\n\nIf you are planing to follow along with this guide on CodePen you will need to add the P5, ReactJs, and React-Dom Libraries. You can add them by going into the settings menu in your pen, clicking on the js option on the left menu, and searching for P5 React and React-Dom in the search bar. the js section of the settings will look something like below when done.\n\n![JS section of settings](PenJSImports.png)\n\nIf you still have trouble check out this [pen's](https://codepen.io/daswelch/pen/eYpYLLG) settings for something to copy and paste. Now lets get back to getting P5 working\n\n### Lets get our P5 code working in \"Global mode\"\n\n<iframe  style=\"width: 100%; height: 400px;\" scrolling=\"no\" title=\"Basic P5 Sketch\" src=\"https://codepen.io/daswelch/embed/zYvqrQv?height=265&theme-id=dark&default-tab=js,result\" frameborder=\"yes\" allowtransparency=\"true\" allowfullscreen=\"true\" loading=\"lazy\">\nSee the Pen <a href='https://codepen.io/daswelch/pen/zYvqrQv'>Basic P5 Sketch</a> by DasWelch\n(<a href='https://codepen.io/daswelch'>@daswelch</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\nThe sketch above is running \"Global mode\". I have added in a class to ensure it will demonstrate converting just about any P5 sketch into an \"Instance mode\" Sketch. In our Pens \"result\" section, we have a black background with two box objects being drawn. Like any P5 sketch we will start by declaring our objects(\"b\" and \"d\" Both Boxes) and our setup and draw functions.\n\n```javascript\n/// the start of our P5 sketch ///\n\nlet b;\nlet d;\n\nfunction setup() {\n    createCanvas(100,100);\n    background(0);\n    b = new Box(0, 0, 20, 20);\n    d = new Box(20, 20, 20, 20);\n}\n\nfunction draw() {\n    background(0);\n    b.display();\n    d.display();\n}\n```\n\nBelow that we will create our Box class. This will be what we use to create boxes on our background.\n\n```javascript\n/// Adding the Box class to our code above ///\n\nlet b;\nlet d;\n\nfunction setup() {...}\n\nfunction draw() {...}\n\n/// Our Box class ///\nclass Box {\n    constructor(_x, _y, _w, _h) {\n        this.x = _x;\n        this.y = _y;\n        this.w = _w;\n        this.h = _h;\n    }\n\n    display() {\n        fill(255);\n        rect(this.x, this.y, this.w, this.h);\n    }\n}\n```\n\nThough this class does not have a lot of functionality, it will help us to demonstrate using classes with \"Instance mode\". Also notice that our sketch just sort of works. It just runs and we do not have to define a start or an object to start it when it is running in \"Global mode\".\n\n### Lets convert sketch to use \"Instance mode\"\n\n<iframe style=\"width: 100%; height: 400px;\" scrolling=\"no\" title=\"p5 instance mode with class \" src=\"https://codepen.io/daswelch/embed/XWmWOxG?height=265&theme-id=dark&default-tab=js,result\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" loading=\"lazy\">\nSee the Pen <a href='https://codepen.io/daswelch/pen/XWmWOxG'>p5 instance mode with class </a> by DasWelch\n(<a href='https://codepen.io/daswelch'>@daswelch</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\nNow we will take our working sketch and convert it to an \"Instance mode\" sketch. To start, we need to create a container to isolate our P5 sketch. We will do this by creating a variable called \"sketch\". we then set this equal to an anonymous function and pass in a single parameter to this function \"p\". This \"p\" will be the object we use to namespace our P5 library.\n\n```javascript\n/// our new sketch Object ///\n\nlet sketch = function (p) {\n\n}\n```\n\nNext we will copy our non class specific code and paste it inside this function. Though we will be making changes to the original code, it is a good start. We can leave our variables \"b\" and \"d\" alone and move down to our setup and draw functions. For both the setup and the draw function, we are going to convert each into its own anonymous function. We will use the \"p\" parameter that we passed into our sketch function to call them. We will set our new anonymous functions equal to \"p.setup\" and \"p.draw\" respectively.\n\n```javascript\n/// Reworking our setup and draw functions for \"Instance mode\" ///\n\nlet sketch = function (p) {\n    let b;\n    let d;\n\n    p.setup = function() {\n        // left out the contents to help with clarity\n    }\n\n    p.draw = function() {\n        // left out the contents to help with clarity\n    }\n}\n```\n\nNow we will modify each of the functions under setup and draw to be called by our \"p\" variable. For example “background(0)” in draw would become \"p.background(0)\".\n\n```javascript\n/// Our P5 functions in \"Instance mode\" ///\n\nlet sketch = function (p) {\n    let b;\n    let d;\n\n    p.setup = function() {\n        // notice our additional code\n        p.createCanvas(100, 100);\n        p.background(0);\n        // we have added our \"p\" parameter here. this will be explained shortly.\n        b = new Box(p, 0, 0, 20, 20);\n        d = new Box(p, 20, 20, 20, 20);\n    }\n\n    p.draw = function () {\n       p.background(0);\n       b.display();\n       d.display();\n  }\n}\n```\n\nNext we will move outside of our base sketch function and focus on the Box class. Because were working no longer working in \"Global mode\", attempting to access P5 functions without an instance object becomes impossible. So how do we access our P5 functions here? We pass instance object into our class. In our Box class constructor we will pass in a variable \"_p\" and set this.p equal to it. The \"_p\" is the instance object(\"p\") from above. It will allow us to use all of the P5 functions we want.\n\n```javascript\n/// Our box class with the Instance object passed in ///\n\nclass Box {\n  constructor(_p, _x, _y, _w, _h) {\n    // this p is our P5 instance object\n    this.p = _p;\n    this.x = _x;\n    ...\n  }\n  ...\n}\n```\n\nNow we can move into our class methods. Unlike our setup and draw functions we do not need to use our instance object \"this.p\" to call our methods. We do however need to use \"this.p\" to call any P5 functions. For example we would change our \"fill(255)\" to \"this.p.fill(255)\".\n\n```javascript\n/// the modified P5 functions ///\n\nclass Box {\n  ...\n  display() {\n    this.p.fill(255);\n    this.p.rect(this.x, this.y, this.w, this.h);\n  }\n}\n```\n\nFinally to get our \"Instance mode\" sketch working we will need to create a new variable that will hold a functioning canvas with our sketch on it. We will call this variable \"mySketch\" and set this new variable equal to a new P5 instance using the “new P5(Sketch, \"container\")” function. In this function the \"sketch\" parameter is the sketch object we created earlier and the \"container\" parameter is the id of the tag on which our P5 sketch will be attached. If we do not have any HTML tags we want to attach our sketch to, our \"container\" parameter can be arbitrarily set to  any string we would like to use.\n\n```javascript\n/// The object that will run our P5 code ///\n\nlet mySketch = new p5(sketch, \"container\");\n```\n\n### Getting React to work Properly\n\n<iframe height=\"265\" style=\"width: 100%; height: 400px;\" scrolling=\"no\" title=\"getting p5 working in react\" src=\"https://codepen.io/daswelch/embed/eYpYLLG?height=265&theme-id=dark&default-tab=js,result\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" loading=\"lazy\">\nSee the Pen <a href='https://codepen.io/daswelch/pen/eYpYLLG'>getting p5 working in react</a> by DasWelch\n(<a href='https://codepen.io/daswelch'>@daswelch</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\nNow comes the part of moving our working \"Instance mode\" sketch into a React component. We will create a React class to house our sketch and its parts. To start we will plug in the boiler plate as shown below.\n\n```jsx\n/// Our React Boiler plate ///\n\nclass MySketch extends React.Component {\n    constructor(props) {\n        super(props)\n    }\n\n    componentDidMount() {\n    \n    }\n\n    render() {\n        return ( \n\n         )\n    }\n}\n```\n\nTo this boiler plate, we are going to add a React reference. A reference allows us to use and modify an element on the page that is not directly under the control of React. This reference will allow our P5 sketch to attach and run on the DOM even with React creating it. We will use React's “React.createRef()” function to create and add a reference to our class. We then create a variable called \"this.myRef\" to hold that reference in the class constructor.\n\n```jsx\n/// Adding in our React Reference ///\n\nclass MySketch extends React.Component {\n    constructor(props) {\n        super(props)\n        this.myRef = React.createRef();\n    }\n    ...\n}\n```\n\nIn addition to this we will utilize the React's “componentDidMount()” function. This will ensure that our sketch will run at the right time and have something to attach to. under our \"componentDidMount()\" function we will add our P5 instance object declaration, as well as the P5 function itself. Just like before our P5 function will take in our sketch object (\"this.sketch\") as well as something to attach that canvas and sketch to. In this case that attachment point will be \"this.myRef.current\". The \".current\" is a required attribute when we use the reference under the \"componentDidMount\" function.\n\n```jsx\n/// Creating our instance under componentDidMount()///\n\nclass MySketch extends React.Component {\n...\n    componentDidMount() {\n    this.myP5 = new p5(this.sketch, this.myRef.current);\n    }\n...\n}\n```\n\nNext we will prepare the render function. This will return a \"div\" tag with its ref property set to the \"MySketch\" reference we set up earlier.\n\n```jsx\n/// Setting up our Render Function ///\n\nclass MySketch extends React.Component {\n...\n    render() {\n        return ( \n          <div ref={this.myRef}></div>;\n         )\n    }\n}\n```\n\nWe now will add in our actual \"Instance mode\" sketch object below our constructor method. Notice we now drop the \"let\" declaration before the sketch as it is within our class.\n\n```jsx\n/// adding in our \"Instance mode\" sketch ///\n\nclass MySketch extends React.Component {\n  constructor(props) {\n    super(props);\n    this.myRef = React.createRef();\n  }\n\n  sketch = (p) => {\n    let b;\n    let d;\n\n    p.setup = function () {\n      p.createCanvas(100, 100);\n      p.background(0);\n      b = new Box(p, 0, 0, 20, 20);\n      d = new Box(p, 20, 20, 20, 20);\n    };\n    p.draw = function () {\n      p.background(0);\n      b.display();\n      d.display();\n    };\n  };\n\n  componentDidMount() {\n    this.myP5 = new p5(this.sketch, this.myRef.current);\n  }\n\n  render() {\n    return <div ref={this.myRef}></div>;\n  }\n}\n```\n\nfinally we can add our Box class below our \"MySketch\" React class. Just like it was before we added in React.\n\n```jsx\nclass MySketch extends React.Component {\n    ...\n}\n\nclass Box {\n  constructor(_p, _x, _y, _w, _h) {\n    // this p is our p5 instance object\n    this.p = _p;\n    this.x = _x;\n    this.y = _y;\n    this.w = _w;\n    this.h = _h;\n  }\n\n  display() {\n    this.p.fill(255);\n    this.p.rect(this.x, this.y, this.w, this.h);\n  }\n}\n```\n\nNow we will add a \"div\" tag with an id of root into the HTML section that will be our root element for React. This will be the point React uses to render our component. We then add the ReactDOM.render(`<MySketch/>`, document.getElementById(\"root\"))\" function with our class as its first argument and a \"document.getElementById\" function as its second.\n\n```html\n<!-- Our HTML root tag for React to use -->\n<div id=\"root\">\n<!-- we can leave this empty as it will be filled programmatically  -->\n</div>\n```\n\n```jsx\n///our ReactDom.Render function ///\n\nclass MySketch extends React.Component {\n   ...\n}\n\nclass Box {\n   ...\n}\n\nReactDOM.render(<MySketch />, document.getElementById(\"root\"));\n```\n\nOnce that is done we will have a functional P5 sketch running inside of React. The finished sketch is at the top of this section if you would like to reference it. Our next task will be transferring this running \"MySketch\" class into our Gatsby site.\n\n### Bringing it together in Gatsby\n\nBefore we start our transfer well need to have our Gatsby environment set up and running. Im going to assume that you are running a basic starter site from Gatsby. Additionally I am going to assume that you know how to use NPM to add packages to your Gatsby installation. If would like some more resources for either of these, here is a link to [Gatsbys starter docs](https://www.gatsbyjs.org/docs/quick-start/) and [NPM starter docs](https://www.npmjs.com/get-npm).\n\nWere going to start by installing P5 from NPM. To do this well move into the root of our Gatsby site and open our shell. Make sure your shell is showing that you are in the root folder for your gatsby starter site. In the shell we will run the npm install command for P5 shown below.\n\n```console\n# Windows\nC: Windows\\PathToRootOfProject\\startersite> npm install --save p5\n#   or\n# Linux\nbashUser:~/PathToRootOfProject/startersite$ npm install --save p5\n```\n\nNow we will be able to use P5 in our site. I'll quickly mention there are other ways to add P5 to a website, but this is the most reliable method I was able find. Now we can open up our editor. I like to use Visual Studio Code which has an easy command to open it \"code .\" in the root of the Gatsby site. from here well move to our \"src\" folder and then our \"components\" folder. From there we will create a new file named \"mysketch.js\". This will be where we place our React component. We can copy and paste our React code from our pen and make some modifications to have it work properly.\n\n```jsx\n/// our React code in file under src > components > mysketch.js ///\n\nclass MySketch extends React.Component {\n  constructor(props) {\n    super(props);\n    this.myRef = React.createRef();\n  }\n\n  Sketch = (p) => {\n    let b;\n    let d;\n\n    p.setup = function () {\n      p.createCanvas(100, 100);\n      p.background(0);\n      b = new Box(p, 0, 0, 20, 20);\n      d = new Box(p, 20, 20, 20, 20);\n    };\n    p.draw = function () {\n      p.background(0);\n      b.display();\n      d.display();\n    };\n  };\n\n  componentDidMount() {\n    this.myP5 = new p5(this.Sketch, this.myRef.current);\n  }\n\n  render() {\n    return <div ref={this.myRef}></div>;\n  }\n}\n\nclass Box {\n  constructor(_p, _x, _y, _w, _h) {\n    // this p is our p5 instance object\n    this.p = _p;\n    this.x = _x;\n    this.y = _y;\n    this.w = _w;\n    this.h = _h;\n  }\n\n  display() {\n    this.p.fill(255);\n    this.p.rect(this.x, this.y, this.w, this.h);\n  }\n}\n\nReactDOM.render(<MySketch />, document.getElementById(\"root\"));\n```\n\nFirst we will add in two import statements at the top of the page. The first import will be for React and the second will be for our P5 library. We need these now because we are importing the libraries locally and not using an online CDN to pull in what we need.\n\n```jsx\n/// component with its import files added ///\n\n// these are our two imports\nimport React from \"react\"\nimport P5 from \"p5\"\n\nclass MySketch extends React.Component {\n ...\n}\n\nclass Box {\n ...\n}\n\nReactDOM.render(<MySketch />, document.getElementById(\"root\"));\n```\n\nNext we will remove the \"ReactDom.render()\" function. We will no longer be using this function as Gatsby will be handling the rendering of our pages. Instead we will add an \"export default\" statement for \"MySketch\" below our Box class.\n\n```jsx\n/// component with its import files added ///\n\nimport React from \"react\"\nimport P5 from \"p5\"\n\nclass MySketch extends React.Component {\n ...\n}\n\nclass Box {\n ...\n}\n\nexport default MySketch\n```\n\nNow we should have a functional React component that we can add a to a page. Lets test this! Lets move to our \"pages\" folder. This can be found under the \"src\" directory. From here we will make a copy of our index.js file in the \"pages\" folder. Lets rename this to \"sketchtester.js\". Open this new page up and get rid of most of the stuff in the file. We should also change the page object name so we do not confuse our new file with our \"index.js\" file in the same folder. Lets rename our page object SketchTester.\n\n```jsx\n/// sketchtester.js file at src > pages > sketchtester.js\n\nimport React from \"react\"\n\n\nconst SketchTester = () => (\n  // We have removed all of the tags from our index page object\n  // in the next step we will add our sketch \n)\n\nexport default SketchTester\n```\n\nNow Lets import our new sketch component and add it to our file. To do this we will add an import statement to the top of our file and then create a JSX tag with the name we gave to our imported sketch component.\n\n```jsx\n/// sketchtester.js file at src > pages > sketchtester.js\n\nimport React from \"react\"\nimport MySketch from \"../components/MySketch\"\n\n\nconst SketchTester = () => (\n    <MySketch/>\n)\n\nexport default SketchTester\n```\n\nNow we are ready to see our work. We can open our shell back up, making sure its in the root of our Gatsby project. From here, we will run the command \"gatsby develop\" to get a development version of the site running. We can access our new site at http://localhost:8000/, but if we want to see our hard work we can go to our sketch tester page located at \"http://localhost:8000/sketchtester\". now we should be able to see our sketch running in our browser window.\n\nimport Sketch from \"$sketches/post2sketch\"\n\n<Sketch bottomText=\"our finished sketch\"/>\n\nFrom here you can play with the new sketch component. Try adding movements or creating more boxes within your sketch. You can also play with adding JSX tags on the page and wrap your sketch in your sites layout. Try changing whatever you would like, but remember to make a copy of your component and sketchtester page so you have a template to follow in the future.\n\nIf you have made it here, Thank you for taking the time to read over this whole post! I hope this helps anyone having issues getting P5 sketches in \"Instance mode\" working, getting sketch working with React, and/or getting a sketch running on a gatsby site. I personally had difficulty finding documentation and help online about each step in this process. I had to stich together many little pieces of information to get to my final goal of a working P5 sketch on my Gatsby site. My next goal is to create more guides about drawing and modeling things using P5 and other drawing libraries. Im also very excited to have my first real post! I'm looking into a comment system soon so hopefully I can get some feed back about how to make this blog better. Thank you for reading and come back soon to see more posts!"},"previous":{"fields":{"slug":"/hello-world/"},"frontmatter":{"title":"Hello World"}},"next":null},"pageContext":{"id":"ffb4cefe-5708-55dd-9849-5e9db14a6633","previousPostId":"b64246bc-3a66-5eab-b03f-b88a497a4993","nextPostId":null}},"staticQueryHashes":["3649515864","712016698"]}